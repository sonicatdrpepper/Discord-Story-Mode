#TODO Move battle functions in here